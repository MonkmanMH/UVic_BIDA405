---
title: "Manipulation of data tables"
subtitle: "sampling"
output:
  html_document:
    df_print: paged
---

<!-- 
This file by Martin Monkman is licensed under a Creative Commons Attribution 4.0 International License. 
-->

```{r setup}
library(tidyverse)
#
library(stringr)  # {stringr} is part of the tidyverse, but not a core package that loads with {tidyverse}

# penguins dataset
library(palmerpenguins)

```



## Objectives

* Understand the reasons for sampling

* Explore techniques for sampling



## Sampling

Frequently, we are called upon to provide a randomly selected sub-set of the whole dataset. 

Why sample? 

* In development stages, it's often easier to test and debug with a smaller dataset.

* A training set for a machine learning model. 

* Create a survey frame. 

* In visualization, too many data points can obscure patterns.

* Sampling can help anonymize records in a sensitive dataset.


R provides a number of sampling functions that allow us to sample our dataset.

In {dplyr}, these functions are `sample_n()` and `sample_frac()`:

* see https://dplyr.tidyverse.org/reference/sample.html

```{r}
set.seed(1)

# sample 25 rows from penguins
penguins %>% 
  sample_n(25)

# sample 10% of the records in penguins (34 of 344 rows)
penguins %>% 
  sample_frac(0.1)

```

In combination with `group_by()`, these functions also allow stratified sampling. In this example, the sample will be of 3 penguins of each species.


```{r}
penguins %>% 
  group_by(species) %>% 
  sample_n(3)
```

The approach below is more complex, in that it keeps the entire dataset intact, and adds a new variable to indicate if the record is sampled or not.

The `runif()` function is in base {r}, and creates a random point between 0 and 1 on a uniform scale (that is, every point has an equal probability of being selected). The `length()` function is required to indicate how may random values are to be created.

The final line assigns a TRUE or FALSE value, depending on whether the value that's randomly generated is larger or smaller than 0.5 (there should be roughly an equal number of values on either side of this point.)


```{r}
penguin_sample <- penguins %>% 
  group_by(species) %>% 
  mutate(sampled = runif(length(species))) %>% 
  mutate(sample_tf = ifelse(sampled < 0.1, TRUE, FALSE))

penguin_sample

penguin_sample %>% 
  group_by(species, sample_tf) %>% 
  tally()
```



---

## REFERENCE


Nina Zumel and John Mount, _Practical Data Science with R (2nd edition)_ (2020)

* Chapter 4 "Managing Data" (4.3 Sampling for modeling and validation)

* [UVic library link](https://learning-oreilly-com.ezproxy.library.uvic.ca/library/view/practical-data-science/9781617295874/?ar?orpq&email=oJbr4Ho8VLXz0zbFzjLK2g%3d%3d&tstamp=1600527352&id=DC7689B4AD2FA446468DD1CE0CCCD91B187CD9C4)


