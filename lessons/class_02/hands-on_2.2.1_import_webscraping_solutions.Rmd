---
title: "Import data: accessing data through web apis"
output: html_notebook
---

<!-- 
This file by Martin Monkman is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License. 
https://creativecommons.org/licenses/by-sa/4.0/

Elements are drawn from the reference materials for the packages
* {haven} -- https://haven.tidyverse.org/
* {labelled} -- http://larmarange.github.io/labelled/reference/index.html


-->



# Webscraping {#webscraping}

As we've seen yesterday, we can access data on the web through various R packages, and using APIs. These tools give us access to data tables that are published as data tables. But what if the data you want populates a web page in a non-tabular format?


* The [Billboard Hot 100 music chart](https://www.billboard.com/charts/hot-100) is updated weekly.

* Weather forecast pages are updated hourly or daily.


See [@Gandrud_2015]


## Getting started

Run this code chunk:

```{r setup}
library(tidyverse)  
# 
library(datapasta) # copy-paste!
#
library(rvest)     # webscraping
```


## Copy-paste

This is perhaps the simplest approach...select the range of what you want, and paste it to the file you want. However, how can you paste a web data table directly into a structure that R can use?  This is where {datapasta} comes in. (Of course, it can be used to copy-paste from other sources, as well. For example, I made an R datatable from the PDF of the class list.)


Reference page: https://milesmcbain.github.io/datapasta/

Once you've installed {datapasta} with `install.packages("datapasta")`, it will appear in your RStudio "Addins"

Let's practice: we will copy and paste the Japanese league stats for the baseball player Ichiro Suzuki (usually just known by his first name).

His player page at baseball-reference.com is https://www.baseball-reference.com/register/player.fcgi?id=suzuki001ich

We can select the range in the "Register Batting" table, and then hit "<ctrl> C" (or "<cmd> C" on a Mac) to copy the range to our clipboard.

If we were to paste it to a text editor, it would look like this:

`Year	Age	AgeDif	Tm	Lg	Lev	Aff	G	PA	AB	R	H	2B	3B	HR	RBI	SB	CS	BB	SO	BA	OBP	SLG	OPS	TB	GDP	HBP	SH	SF	IBB`
`1992	18	-10.8	Orix	JPPL	Fgn		40	99	95	9	24	5	0	0	5	3	2	3	11	.253	.276	.305	.581	29	0	0	1	0	0`
`1993	19	-10.1	Orix	JPPL	Fgn		43	67	64	4	12	2	0	1	3	0	2	2	7	.188	.212	.266	.478	17	2	0	1	0	0`
`1994	20	-9.1	Orix	JPPL	Fgn		130	616	546	111	210	41	5	13	54	29	7	51	53	.385	.445	.549	.994	300	3	10	7	2	8`
`1995	21	-7.6	Orix	JPPL	Fgn		130	613	524	104	179	23	4	25	80	49	9	68	52	.342	.432	.544	.976	285	7	18	0	3	17`
`1996	22	-6.5	Orix	JPPL	Fgn		130	611	542	104	193	24	4	16	84	35	3	56	57	.356	.422	.504	.926	273	8	9	0	4	13`
`1997	23	-4.9	Orix	JPPL	Fgn		135	607	536	94	185	31	4	17	91	39	4	62	36	.345	.414	.513	.927	275	10	4	0	5	14`
`1998	24	-4.1	Orix	JPPL	Fgn		135	558	506	79	181	36	3	13	71	11	4	43	35	.358	.414	.518	.932	262	21	7	0	2	15`
`1999	25	-2.9	Orix	JPPL	Fgn		103	468	411	80	141	27	2	21	68	12	1	45	46	.343	.412	.572	.984	235	5	7	0	5	15`
`2000	26	-2.6	Orix	JPPL	Fgn		105	459	395	73	153	22	1	12	73	21	1	54	36	.387	.460	.539	.999	213	3	4	0	`

We might be able to fuss about with this and make it work (remember about space delimited plain text files!), but {datapasta} allows us to paste it directly into our R code chunk.

Using the addin or the keyboard shortcut for a data.frame, it looks like this:

```{r}

data.frame(
  stringsAsFactors = FALSE,
       check.names = FALSE,
              Year = c(1992L,1993L,1994L,1995L,
                       1996L,1997L,1998L,1999L,2000L),
               Age = c(18L, 19L, 20L, 21L, 22L, 23L, 24L, 25L, 26L),
            AgeDif = c(-10.8, -10.1, -9.1, -7.6, -6.5, -4.9, -4.1, -2.9, -2.6),
                Tm = c("Orix","Orix","Orix","Orix",
                       "Orix","Orix","Orix","Orix","Orix"),
                Lg = c("JPPL","JPPL","JPPL","JPPL",
                       "JPPL","JPPL","JPPL","JPPL","JPPL"),
               Lev = c("Fgn","Fgn","Fgn","Fgn",
                       "Fgn","Fgn","Fgn","Fgn","Fgn"),
               Aff = c(NA, NA, NA, NA, NA, NA, NA, NA, NA),
                 G = c(40L, 43L, 130L, 130L, 130L, 135L, 135L, 103L, 105L),
                PA = c(99L, 67L, 616L, 613L, 611L, 607L, 558L, 468L, 459L),
                AB = c(95L, 64L, 546L, 524L, 542L, 536L, 506L, 411L, 395L),
                 R = c(9L, 4L, 111L, 104L, 104L, 94L, 79L, 80L, 73L),
                 H = c(24L, 12L, 210L, 179L, 193L, 185L, 181L, 141L, 153L),
              `2B` = c(5L, 2L, 41L, 23L, 24L, 31L, 36L, 27L, 22L),
              `3B` = c(0L, 0L, 5L, 4L, 4L, 4L, 3L, 2L, 1L),
                HR = c(0L, 1L, 13L, 25L, 16L, 17L, 13L, 21L, 12L),
               RBI = c(5L, 3L, 54L, 80L, 84L, 91L, 71L, 68L, 73L),
                SB = c(3L, 0L, 29L, 49L, 35L, 39L, 11L, 12L, 21L),
                CS = c(2L, 2L, 7L, 9L, 3L, 4L, 4L, 1L, 1L),
                BB = c(3L, 2L, 51L, 68L, 56L, 62L, 43L, 45L, 54L),
                SO = c(11L, 7L, 53L, 52L, 57L, 36L, 35L, 46L, 36L),
                BA = c(0.253,0.188,0.385,0.342,
                       0.356,0.345,0.358,0.343,0.387),
               OBP = c(0.276,0.212,0.445,0.432,
                       0.422,0.414,0.414,0.412,0.46),
               SLG = c(0.305,0.266,0.549,0.544,
                       0.504,0.513,0.518,0.572,0.539),
               OPS = c(0.581,0.478,0.994,0.976,
                       0.926,0.927,0.932,0.984,0.999),
                TB = c(29L, 17L, 300L, 285L, 273L, 275L, 262L, 235L, 213L),
               GDP = c(0L, 2L, 3L, 7L, 8L, 10L, 21L, 5L, 3L),
               HBP = c(0L, 0L, 10L, 18L, 9L, 4L, 7L, 7L, 4L),
                SH = c(1L, 1L, 7L, 0L, 0L, 0L, 0L, 0L, 0L),
                SF = c(0L, 0L, 2L, 3L, 4L, 5L, 2L, 5L, 6L),
               IBB = c(0L, 0L, 8L, 17L, 13L, 14L, 15L, 15L, 16L)
)data.frame(
  stringsAsFactors = FALSE,
       check.names = FALSE,
               Year = c(1992L,1993L,1994L,1995L,
                        1996L,1997L,1998L,1999L,2000L),
               Age = c(18L, 19L, 20L, 21L, 22L, 23L, 24L, 25L, 26L),
            AgeDif = c(-10.8, -10.1, -9.1, -7.6, -6.5, -4.9, -4.1, -2.9, -2.6),
                 Tm = c("Orix","Orix","Orix",
                        "Orix","Orix","Orix","Orix","Orix","Orix"),
                 Lg = c("JPPL","JPPL","JPPL",
                        "JPPL","JPPL","JPPL","JPPL","JPPL","JPPL"),
                Lev = c("Fgn","Fgn","Fgn","Fgn",
                        "Fgn","Fgn","Fgn","Fgn","Fgn"),
               Aff = c(NA, NA, NA, NA, NA, NA, NA, NA, NA),
                 G = c(40L, 43L, 130L, 130L, 130L, 135L, 135L, 103L, 105L),
                PA = c(99L, 67L, 616L, 613L, 611L, 607L, 558L, 468L, 459L),
                AB = c(95L, 64L, 546L, 524L, 542L, 536L, 506L, 411L, 395L),
                 R = c(9L, 4L, 111L, 104L, 104L, 94L, 79L, 80L, 73L),
                 H = c(24L, 12L, 210L, 179L, 193L, 185L, 181L, 141L, 153L),
              `2B` = c(5L, 2L, 41L, 23L, 24L, 31L, 36L, 27L, 22L),
              `3B` = c(0L, 0L, 5L, 4L, 4L, 4L, 3L, 2L, 1L),
                HR = c(0L, 1L, 13L, 25L, 16L, 17L, 13L, 21L, 12L),
               RBI = c(5L, 3L, 54L, 80L, 84L, 91L, 71L, 68L, 73L),
                SB = c(3L, 0L, 29L, 49L, 35L, 39L, 11L, 12L, 21L),
                CS = c(2L, 2L, 7L, 9L, 3L, 4L, 4L, 1L, 1L),
                BB = c(3L, 2L, 51L, 68L, 56L, 62L, 43L, 45L, 54L),
                SO = c(11L, 7L, 53L, 52L, 57L, 36L, 35L, 46L, 36L),
                 BA = c(0.253,0.188,0.385,0.342,
                        0.356,0.345,0.358,0.343,0.387),
                OBP = c(0.276,0.212,0.445,0.432,
                        0.422,0.414,0.414,0.412,0.46),
                SLG = c(0.305,0.266,0.549,0.544,
                        0.504,0.513,0.518,0.572,0.539),
                OPS = c(0.581,0.478,0.994,0.976,
                        0.926,0.927,0.932,0.984,0.999),
                TB = c(29L, 17L, 300L, 285L, 273L, 275L, 262L, 235L, 213L),
               GDP = c(0L, 2L, 3L, 7L, 8L, 10L, 21L, 5L, 3L),
               HBP = c(0L, 0L, 10L, 18L, 9L, 4L, 7L, 7L, 4L),
                SH = c(1L, 1L, 7L, 0L, 0L, 0L, 0L, 0L, 0L),
                SF = c(0L, 0L, 2L, 3L, 4L, 5L, 2L, 5L, 6L),
               IBB = c(0L, 0L, 8L, 17L, 13L, 14L, 15L, 15L, 16L)
 )

data.frame(
  stringsAsFactors = FALSE,
       check.names = FALSE,
              Year = c(1992L,1993L,1994L,1995L,
                       1996L,1997L,1998L,1999L,2000L),
               Age = c(18L, 19L, 20L, 21L, 22L, 23L, 24L, 25L, 26L),
            AgeDif = c(-10.8, -10.1, -9.1, -7.6, -6.5, -4.9, -4.1, -2.9, -2.6),
                Tm = c("Orix","Orix","Orix","Orix",
                       "Orix","Orix","Orix","Orix","Orix"),
                Lg = c("JPPL","JPPL","JPPL","JPPL",
                       "JPPL","JPPL","JPPL","JPPL","JPPL"),
               Lev = c("Fgn","Fgn","Fgn","Fgn",
                       "Fgn","Fgn","Fgn","Fgn","Fgn"),
               Aff = c(NA, NA, NA, NA, NA, NA, NA, NA, NA),
                 G = c(40L, 43L, 130L, 130L, 130L, 135L, 135L, 103L, 105L),
                PA = c(99L, 67L, 616L, 613L, 611L, 607L, 558L, 468L, 459L),
                AB = c(95L, 64L, 546L, 524L, 542L, 536L, 506L, 411L, 395L),
                 R = c(9L, 4L, 111L, 104L, 104L, 94L, 79L, 80L, 73L),
                 H = c(24L, 12L, 210L, 179L, 193L, 185L, 181L, 141L, 153L),
              `2B` = c(5L, 2L, 41L, 23L, 24L, 31L, 36L, 27L, 22L),
              `3B` = c(0L, 0L, 5L, 4L, 4L, 4L, 3L, 2L, 1L),
                HR = c(0L, 1L, 13L, 25L, 16L, 17L, 13L, 21L, 12L),
               RBI = c(5L, 3L, 54L, 80L, 84L, 91L, 71L, 68L, 73L),
                SB = c(3L, 0L, 29L, 49L, 35L, 39L, 11L, 12L, 21L),
                CS = c(2L, 2L, 7L, 9L, 3L, 4L, 4L, 1L, 1L),
                BB = c(3L, 2L, 51L, 68L, 56L, 62L, 43L, 45L, 54L),
                SO = c(11L, 7L, 53L, 52L, 57L, 36L, 35L, 46L, 36L),
                BA = c(0.253,0.188,0.385,0.342,
                       0.356,0.345,0.358,0.343,0.387),
               OBP = c(0.276,0.212,0.445,0.432,
                       0.422,0.414,0.414,0.412,0.46),
               SLG = c(0.305,0.266,0.549,0.544,
                       0.504,0.513,0.518,0.572,0.539),
               OPS = c(0.581,0.478,0.994,0.976,
                       0.926,0.927,0.932,0.984,0.999),
                TB = c(29L, 17L, 300L, 285L, 273L, 275L, 262L, 235L, 213L),
               GDP = c(0L, 2L, 3L, 7L, 8L, 10L, 21L, 5L, 3L),
               HBP = c(0L, 0L, 10L, 18L, 9L, 4L, 7L, 7L, 4L),
                SH = c(1L, 1L, 7L, 0L, 0L, 0L, 0L, 0L, 0L),
                SF = c(0L, 0L, 2L, 3L, 4L, 5L, 2L, 5L, 6L),
               IBB = c(0L, 0L, 8L, 17L, 13L, 14L, 15L, 15L, 16L)
)


```



More "how to datapasta" https://milesmcbain.github.io/datapasta/articles/how-to-datapasta.html


## Lesson: Introduction to webscraping

Library Carpentry, https://librarycarpentry.org/lc-webscraping/





## Lesson: Webscraping

[Tutorial: Web Scraping in R with rvest](https://www.dataquest.io/blog/web-scraping-in-r-rvest/)


## Lesson: 

Grant R. McDermott, _Big Data in Economics_ [@McDermott_BDE_2020]

* [Webscraping: (1) Server-side and CSS](https://raw.githack.com/uo-ec510-2020-spring/lectures/master/07-web-css/07-web-css.html)

* [Webscraping: (2) Client-side and APIs](https://raw.githack.com/uo-ec510-2020-spring/lectures/master/08-web-api/08-web-api.html)


## Other lessons

[Examples of Web Scraping With R](https://www.programmingr.com/examples/examples-web-scraping-r/)

[Web Scraping with R](https://www.scrapingbee.com/blog/web-scraping-r/) - ?


[Beginner’s Guide on Web Scraping in R (using rvest) with hands-on example](https://www.analyticsvidhya.com/blog/2017/03/beginners-guide-on-web-scraping-in-r-using-rvest-with-hands-on-knowledge/)


[Tidy web scraping in R — Tutorial and resources](https://towardsdatascience.com/tidy-web-scraping-in-r-tutorial-and-resources-ac9f72b4fe47)



## {polite} package

https://dmi3kno.github.io/polite/index.html

[@R-polite]



## {rvest} package

[@R-rvest]


[@doi:10.1080/10691898.2020.1787116]


