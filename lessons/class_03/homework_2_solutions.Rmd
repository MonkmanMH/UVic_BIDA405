---
title: "Week 2: excercise"
output: html_notebook
---

<!-- 
This file by Martin Monkman is licensed under a Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0). 
https://creativecommons.org/licenses/by-sa/4.0/
-->



```{r setup}
library(tidyverse)
library(readxl)

library(bcdata)
```




## 1. COVID-19 in BC

Use what you know about the functions in the {bcdata} package to import the details about COVID-19 cases in British Columbia. Assign the data to an R dataframe object with a meaningful name.


### hint

First search the data catalogue

```{r}
bcdc_search("COVID")
```

Then access the data.

```{r}
covid_cases <- bcdc_get_data("b-c-covid-19-case-details")
```



## 2. Tribbles

Create a data table using the `tribble()` function from the {tibbble} package. This will return a "tibble" format data table. Your table will have the following specifications:

* seven variables, with the days of the week in order (it's ok if you start on Sunday or Monday)

* the numbers 1 through 30, with the 1 starting on the Tuesday

(You're making a calendar for September 2020!)

How will you deal with the fact that the first day or two of the table aren't part of the month? And that the last day of the month is a Wednesday?

### solution

```{r}

tribble(
  ~Sunday, ~Monday, ~Tuesday, ~Wednesday, ~Thursday, ~Friday, ~Saturday,
  NA, NA, 1, 2, 3, 4, 5,
  6, 7, 8, 9, 10, 11, 12,
  13, 14, 15, 16, 17, 18, 19,
  20, 21, 22, 23, 24, 25, 26,
  27, 28, 29, 30, NA, NA, NA
)


```


# 3. Reading Excel files

This exercise relies on the package {readxl}. 

* [documentation for {readxl}](https://readxl.tidyverse.org/)

 - in particular, review the "Overview" page and the "Articles"
 


## 3.1. New Homes Registry

The B.C. Ministry of Municipal Affairs and Housing publishes data from BC Housing's New Homes Registry, by regional district and municipality, by three types types of housing: single detached, multi-unit homes, and purpose built rental.

The name of this file is "bc-stats_2018-new-homes-data_tosend.xlsx"


### 3.1a. Explore the file

List the sheet names in the file. 

```{r}

excel_sheets("bc-stats_2018-new-homes-data_tosend.xlsx")

```


### 3.1b. Importing a sheet
 
 Here's a screenshot of the top rows of the sheet with single detached housing:
 
 ![single detached](newhomes_single_excel.JPG)
 
 What problems do you anticipate with the way this sheet is laid out? 
 
 * For a data analytics project, will you need all of the rows and columns that have information?
 
 * Check the data types of each column.
 
Read in the sheet, using no options. What is notable about the content of the R data table, compared to the Excel source?


```{r}

read_excel("bc-stats_2018-new-homes-data_tosend.xlsx", sheet = "Purpose Built Rental")

```

Read the file again, so that the header rows are in the right place, and with the "Note:" column omitted.

(See [this page on the {readxl} reference material](https://readxl.tidyverse.org/reference/cell-specification.html) for some tips.)
 
Note: some solutions to this problem would involve some of the {dplyr} data manipulations, once you've created an object that you can manipulate in the R environment.


```{r}

housing1 <- read_excel("bc-stats_2018-new-homes-data_tosend.xlsx", sheet = "Single Detached", 
                       na = "*",
                       skip = 3)

# Because this has columns F and G included, we can then use "select" to pick the ones we want

housing1 <- housing1 %>% 
  select(1:4) %>% 
  rename("community" = `...1` )

housing1

```




```{r}

housing2 <- read_excel("bc-stats_2018-new-homes-data_tosend.xlsx", sheet = "Single Detached", 
                       na = "*",
                       range = cell_limits(c(4, NA), c(NA, 5)))

housing2 %>% 
  select(2:5) %>%
  rename("community" = `...2`)

```



```{r}

housing3 <- 
  read_excel("bc-stats_2018-new-homes-data_tosend.xlsx", sheet = "Single Detached",
             na = "*",
             range = anchored("B4", dim = c(NA, 4)))

housing3 %>%
  rename("community" = "...1")

```



### 3.1c. Tidy data

Does this data frame violate any of the principles of tidy data? (See the links below for reference materials)
 
If so, use the pivot functions from {tidyr} to turn it into a tidy structure.

```{r}

housing1

housing1_long <- housing1 %>%
  pivot_longer(-community, names_to = "year", values_to = "units")

housing1_long

```


## REFERENCE MATERIAL


_R for Data Science_, "Data Import":
https://r4ds.had.co.nz/data-import.html


_R Cookbook (2nd ed.)_, "Input and Output":
https://rc2e.com/inputandoutput


Tidy data:

* [_R for Data Science_, Tidy data: 12.1 and 12.2](https://r4ds.had.co.nz/tidy-data.html)

* For a deeper dive into the topic, see Hadley Wickham, ["Tidy Data"](https://vita.had.co.nz/papers/tidy-data.pdf), _Journal of Statistical Software_ 
https://vita.had.co.nz/papers/tidy-data.pdf




### Package reference pages

{readr} 
https://readr.tidyverse.org/

{readxl}
https://readxl.tidyverse.org/index.html


