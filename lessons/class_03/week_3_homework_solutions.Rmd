---
title: "BIDA 405 - week 3"
subtitle: "homework assignment #3: solutions"
author: "Martin Monkman"
date: "2020/09/20"
output: html_notebook
---

```{r setup}

library(tidyverse)

library(validate)

```

# Using {validate} 

Load the `retailers` data (housed in the {validate} package)

(Note that we use the function `data()` to access data tables that are included in an R package.)

```{r}

data(retailers)

```


Use the `check_that()` function to check the following assumptions:

* Turnover is larger than or equal to zero (Turnover can't be a negative number)

* The costs per staff are below 50,000 (This is a "sanity check"--in general in the retail sector, we would expect costs to be below this threshold)

```{r}

cf <- check_that(retailers, turnover > 0, staff.costs/staff < 50)
summary(cf)

```


> Q1. Summarize what this table is telling us.


Now we will create an object using the `validator()` function, with the two tests above plus three more: 

```{r}

val_retail <- validator(
    turnover > 0, staff.costs / staff < 50,
    total.costs >= 0,
    staff >= 0,
    turnover + other.rev == total.rev
)

val_retail

```

> Q2a. Write a text description of the three additional tests

> Q2b. Run the validator scripts against the `retailers` data, and write a short text description of the passes, fails and NAs of each test

```{r}

cf <- confront(retailers, val_retail)
cf

summary(cf)

```




> Q3. Create a single `validator()` object for the `retailers` dataset with the following rules:
>
>* Non-negativity for the variables `staff`, `staff.cost`, and `total.cost`
>
>* `if (staff > 0) staff.cost > 0`
>
>* The total cost must be larger than or equal to the staff cost
>

## Solution

```{r}

Q3v <- validator(
    staff > 0,
    staff.costs > 0,
    total.costs > 0,
    if (staff > 0) staff.cost > 0,
    total.costs >= staff.costs)

cf_retail <- confront(retailers, Q3v)

cf_retail

summary(cf_retail)
```



>Confront this validator object with the `retailers` dataset and summarize the result with `summary`. Answer >the following questions:
>
>Q4a. Which rule is violated most often?
>
>Q4b. Which rule resulted in the most missings? Why do you think this is?

V5, total cost > staff costs (it combines the missings from both variables)

>
>Q4c. Discuss the expression for the conditional rule on `staff` and `staff.cost`

The variable is `staff.costs` with an "s" at the end, so the typo is throwing an error


## Remove duplicates

Here's a longer version of the Canadian city population table.
 
```{r}

can_city <- tribble(
  ~city, ~province, ~population,
  "St. John's", "NL", 212433,
  "Fredricton", "NB", 109883,
  "Halifax", "NS", 440348,
  "QuÃ©bec", "PQ", 824411,
  "Toronto", "ON", 6471850,
  "Vancouver", "BC", 2691351,
  "Victoria", "BC", 402271,
  "Vancouver", "BC", 2691351,
  "Victoria", "BC", 396110
)

can_city

```

>Q5. What happens when we use `distinct(province, .keep_all = TRUE)` ?_


>Q6. This function reads the CSV file with the BC COVID-19 cases by age. The code chunk below reads the file, and then tabulates the cases by the age groups. (Data source: https://github.com/jeanpaulrsoucy/covid-19-canada-gov-data/blob/master/bc/case-data/BCCDC_COVID19_Dashboard_Case_Details_2020-08-24_20-45.csv)

> This chunk shows how the "10-19" age group category was converted to a date by Excel, so now it reads "19-Oct".


```{r}

bccovid <- read_csv("BCCDC_COVID19_Dashboard_Case_Details_2020-08-24_20-45.csv")

bccovid %>% 
    group_by(Age_Group) %>% 
    tally()

```

> Use a `case_when()` function to correct this error in labeling.


-30-
